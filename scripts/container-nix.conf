# Optimized Nix configuration for containers
# Copy to /etc/nix/nix.conf or source from container startup

# Binary caches for faster downloads
substituters = https://cache.nixos.org https://nix-community.cachix.org https://devenv.cachix.org
trusted-public-keys = cache.nixos.org-1:6NCHdD59X431o0gWypbMrAURkbJ16ZPMQFGspcDShjY= nix-community.cachix.org-1:mB9FSh9qf2dCimDSUo8Zy7bkq5CX+/rkCWyvRCYg3Fs= devenv.cachix.org-1:w1cLUi8dv3hnoSPGAuibQv+f9TZLr6cv/Hm9XgU50cw=

# Performance optimizations
max-jobs = auto
cores = 0
max-substitution-jobs = 16
http-connections = 128
connect-timeout = 10
download-attempts = 3

# Memory management for containers
min-free = 134217728  # 128MB
max-free = 1073741824 # 1GB

# Build optimizations
keep-outputs = false
keep-derivations = false
auto-optimise-store = true

# Cache settings
narinfo-cache-negative-ttl = 0
narinfo-cache-positive-ttl = 3600

# Enable modern features
experimental-features = nix-command flakes

# Trust settings for container environment
trusted-users = root @wheel
allowed-users = *

# Sandbox settings (may need adjustment based on container runtime)
sandbox = false

# Logging
log-lines = 25
show-trace = true